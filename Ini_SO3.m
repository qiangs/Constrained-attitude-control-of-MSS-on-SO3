clear all;
close all;
clc;

J0= [60 0 -5;
    0 65 0;
    -5 0 70];
J1= [60 0 -5;
    0 65 0;
    -5 0 70];
J2= [60 0 -5;
    0 65 0;
    -5 0 70];
J3= [60 0 -5;
    0 65 0;
    -5 0 70];

%% Meet constraints
% [nd0,Angd0] = Q2NA([0.1092;0;-0.4624;0.8799]);
[nd0,Angd0] = Q2NA([0.1092;0;-0.4624;-0.8799]);  %% 负的才能和Auto对上
Rd0 = SO3(-(2*pi-Angd0),nd0);
%  Rd0   =[0.6549   -0.6911    0.3057;
%    -0.0340    0.3772    0.9255;
%    -0.7550   -0.6165    0.2235];
% Rd0 = SO3(1.47261894051566,[0.403189897217743;-0.279703181668540;-0.160966249608764]);

% aa=Rd0*[0,0,1]'
% bb=Rd0*[0,1,0]'

% R01 = SO3([2.1463], [-0.1366,0.9582,0.2514]');
% R02 = SO3(1.422, [0.1772,0.9751,-0.1329]');
% R03 = SO3(2.007, [0.2997,0.9415,0.1543]');
%% Do not meet constraints

R01 = SO3(deg2rad(-80), nd0);
% R02 = SO3(deg2rad(80), [0;1;0]/norm([0;1;0]));
% R03 = SO3(deg2rad(120), [0;1;1]/norm([0;1;1]));
% R02 = SO3(deg2rad(-80), nd0);
R02 = SO3(deg2rad(40),[0;1;1]/norm([0;1;1]));
% R03 = SO3(deg2rad(-120), nd0);
R03 = SO3(deg2rad(-120), nd0);

% R01 = SO3(deg2rad(-57), nd0);
% % R02 = SO3(deg2rad(80), [0;1;0]/norm([0;1;0]));
% % R03 = SO3(deg2rad(120), [0;1;1]/norm([0;1;1]));
% R02 = SO3(deg2rad(-57), nd0);
% R03 = SO3(deg2rad(-57), nd0);



Omega0d=[0;0;0];
Omega01=[0.03;0.02;-0.03];
Omega02=[-0.02;0.02;-0.03];
Omega03=[0;0.03;0.04];
% Omega01=[0,0,0];
% Omega02=[0,0,0];
% Omega03=[0,0,0];

% Rd = SO3(1.861, [-0.6227,-0.6601,0.0957]');

[nd,Angd] = Q2NA([0.5624;-0.5689;0; -0.6]);
Rd = SO3(-(2*pi-Angd),nd);
% Rd0 =Rd;
%% mixed attitude constraints
X=zeros(4,4); % n*4

X(1,:) = [0,-1,0,deg2rad(30)];
X(2,:) = [0.68,0.67,0.28,deg2rad(25)];
X(3,:) = [0.38,0,0.925,deg2rad(20)];
X(4,:) = [-0.813,0.548,-0.192,deg2rad(50)];

% X(:,1) = [0 ;-1; 0];
% X(:,2) = [0.68;0.67;0.28];
% X(:,3) = [0.38;0;0.925];  
% X(:,4) = [-0.813;0.548;-0.192];


thate_T = deg2rad(30);

G = [1,0,0;
     0,1,0;
     0,0,1];


%%  初始化Usat
R=1;
% deltat=0.02;
deltar=0.005;
N=R/deltar;

%% 控制参数初始化

% K1=[0.01,0,100,0.4]'; %k1-k4 Rd
K1=[0.01,0,30,0.2]'; %k1-k4 Rd  虚拟航天器参数
% K1=[0.01,0,0,0.01]'; %k1-k4 Rd
% K2=[0.01,3,25,0.5]'; %k1-k4 R1-R3  keixing

% K2=[0,0,160,9]';

K2=[0.01,55,55,16,0.001,0.001,0.001]';


alpha1=0.25;
lambda1=0.25;

alpha=0.05;
lambda=0.05;
beta=0.05;



